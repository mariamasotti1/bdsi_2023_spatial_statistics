<!DOCTYPE html>
<html lang="en"><head>
<script src="lecture_slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="lecture_slides_files/libs/quarto-html/tabby.min.js"></script>
<script src="lecture_slides_files/libs/quarto-html/popper.min.js"></script>
<script src="lecture_slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lecture_slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lecture_slides_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lecture_slides_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="lecture_slides_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.353">

  <meta name="author" content="Maria Masotti">
  <meta name="dcterms.date" content="2023-07-20">
  <title>Spatial Statistics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lecture_slides_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lecture_slides_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="lecture_slides_files/libs/revealjs/dist/theme/quarto.css">
  <link href="lecture_slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lecture_slides_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lecture_slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lecture_slides_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Spatial Statistics</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Maria Masotti 
</div>
</div>
</div>

  <p class="date">2023-07-20</p>
</section>
<section id="roadmap-for-today" class="slide level2">
<h2>Roadmap for today</h2>
<ul>
<li><p>Introduce the 3 main types of spatial data</p></li>
<li><p>Learn key concepts and techniques in the statistical analysis of areal spatial data through a real data example</p>
<ul>
<li><p>Pull cenus data in R</p></li>
<li><p>Map areal data with ggplot</p></li>
<li><p>Motivate the need for spatial models</p></li>
<li><p>Apply and interpret a CAR model</p></li>
<li><p>Learn how to apply and interpret geographically weighted regression</p></li>
</ul></li>
</ul>
</section>
<section id="what-are-spatial-data" class="slide level2">
<h2>What are spatial data?</h2>
<p>Data that have “geographical” references. Data that can be mapped.</p>
<p>Applications in</p>
<ul>
<li><p>geology</p></li>
<li><p>medical imaging</p></li>
<li><p>epidemiology</p></li>
<li><p>ecology</p></li>
<li><p>civil engineering</p></li>
</ul>
</section>
<section id="types-of-spatial-data" class="slide level2">
<h2>Types of spatial data</h2>
<ol type="1">
<li><p>Geostatistical</p></li>
<li><p>Point pattern</p></li>
<li><p>Areal</p></li>
</ol>
</section>
<section id="geostatistical-data" class="slide level2">
<h2>Geostatistical Data</h2>
<p>The quantity of interest has a continuous value at any location but we only measure the quantity at certain sites. These values are our data.</p>

<img data-src="temp.png" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://www.usairnet.com/weather/maps/current/current-temperature/">source</a></p></section>
<section id="point-pattern-data" class="slide level2">
<h2>Point Pattern Data</h2>
<p>The main interest is in the locations of all occurrences of some event. Exact locations are recorded.</p>

<img data-src="bigfoot_sighting.webp" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://www.nbcnews.com/sciencemain/looking-bigfoot-follow-map-others-have-seen-em-there-4b11203811">source</a></p></section>
<section id="areal-data" class="slide level2">
<h2>Areal Data</h2>
<ul>
<li><p>Spatial data measured and reported by regions</p></li>
<li><p>Only one value is reported for a region</p></li>
<li><p>Often arises by aggregation; data may be aggregated due to convenience or to protect confidentiality</p></li>
</ul>

<img data-src="bigfoot_state.jpeg" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://www.satelliteinternet.com/resources/states-with-the-most-bigfoot-sightings/">source</a></p></section>
<section id="spatial-data-are-everywhere" class="slide level2">
<h2>Spatial data are everywhere</h2>
<ul>
<li><p><a href="https://www.nytimes.com/interactive/2022/12/13/climate/climate-footprint-map-neighborhood.html">The Climate Impact of Your Neighborhood (NYT)</a></p></li>
<li><p><a href="https://projects.two-n.com/mta/#section-map-2">MTA Ridership Changes due to COVID-19 (TWO-N Inc)</a></p></li>
<li><p><a href="https://especiales.eldiario.es/spain-lives-in-flats/">Spain Lives in Flats (especiales.eldiario.es)</a></p></li>
</ul>
</section>
<section id="whats-the-big-deal" class="slide level2">
<h2>What’s the big deal?</h2>
<ul>
<li>Maps, images, and other spatial data often display strong positive spatial autocorrelation, the tendency for sites that are close together to have similar values.</li>
</ul>

<img data-src="images/Screen%20Shot%202023-07-17%20at%202.07.16%20PM.png" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://mgimond.github.io/Spatial/spatial-autocorrelation.html">Source</a></p></section>
<section id="spatial-autocorrelation" class="slide level2">
<h2>Spatial Autocorrelation</h2>
<p>Leveraging spatial autocorrelation:</p>
<ul>
<li>more accurate prediction</li>
<li>increase power</li>
</ul>
<p>Ignoring spatial autocorrelation:</p>
<ul>
<li>increased bias</li>
<li>deflated variance estimates</li>
<li>increased type 1 error rates</li>
</ul>
</section>
<section id="modeling-median-home-value-mhv-in-se-michigan" class="slide level2">
<h2>Modeling Median Home Value (MHV) in SE Michigan</h2>
<p>Goals:</p>
<ol type="1">
<li>Identify best neighborhoods to purchase a house</li>
<li>Determine what variables influence MHV in SE Michigan</li>
<li>Check for non-stationarity in the effects of the influential variables</li>
</ol>
</section>
<section id="follow-along" class="slide level2">
<h2>Follow along!</h2>
<p>Run the analysis yourself with the R markdown file</p>
<p>Pull and analyze data from another city - how does it compare?</p>
</section>
<section id="libraries" class="slide level2">
<h2>Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidycensus"</span>)) <span class="fu">install.packages</span>(<span class="st">'tidycensus'</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyverse"</span>)) <span class="fu">install.packages</span>(<span class="st">'tidyverse'</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tigris"</span>)) <span class="fu">install.packages</span>(<span class="st">'tigris'</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"sf"</span>)) <span class="fu">install.packages</span>(<span class="st">'sf'</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"units"</span>)) <span class="fu">install.packages</span>(<span class="st">'units'</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggcorrplot"</span>)) <span class="fu">install.packages</span>(<span class="st">'ggcorrplot'</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"car"</span>)) <span class="fu">install.packages</span>(<span class="st">'car'</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"spdep"</span>)) <span class="fu">install.packages</span>(<span class="st">'spdep'</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"CARBayes"</span>)) <span class="fu">install.packages</span>(<span class="st">'CARBayes'</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"GWmodel"</span>)) <span class="fu">install.packages</span>(<span class="st">'GWmodel'</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"patchwork"</span>)) <span class="fu">install.packages</span>(<span class="st">'patchwork'</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">library</span>(tidycensus);<span class="fu">library</span>(tidyverse)</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">library</span>(tigris);<span class="fu">library</span>(GWmodel)</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">library</span>(sf);<span class="fu">library</span>(CARBayes)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(spdep);<span class="fu">library</span>(units)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(car);<span class="fu">library</span>(ggcorrplot)</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="my-journey" class="slide level2">
<h2>My Journey</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="nu.png"></p>
</div><div class="column" style="width:60%;">
<p><img data-src="umn.png"></p>
<p><img data-src="um.png"></p>
</div>
</div>
</section>
<section class="slide level2">

<p>We will pull data from the ACS (American Community Survey) using the <code>tidycensus</code> R package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="1-12|13-21|22-25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>variables_to_get <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="at">median_value =</span> <span class="st">"B25077_001"</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="at">median_rooms =</span> <span class="st">"B25018_001"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="at">median_income =</span> <span class="st">"DP03_0062"</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="at">total_population =</span> <span class="st">"B01003_001"</span>,</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="at">median_age =</span> <span class="st">"B01002_001"</span>,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="at">pct_college =</span> <span class="st">"DP02_0068P"</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="at">pct_foreign_born =</span> <span class="st">"DP02_0094P"</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="at">pct_white =</span> <span class="st">"DP05_0077P"</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="at">median_year_built =</span> <span class="st">"B25037_001"</span>,</span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="at">percent_ooh =</span> <span class="st">"DP04_0046P"</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>)</span>
<span id="cb2-13"><a href="#cb2-13"></a>housing_data <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="at">variables =</span> variables_to_get,</span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="at">state =</span> <span class="st">"MI"</span>,</span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="at">county =</span> <span class="fu">c</span>(<span class="st">"Washtenaw"</span>,<span class="st">"Wayne"</span>,<span class="st">"Oakland"</span>,<span class="st">"Macomb"</span>,<span class="st">"Livingston"</span>),</span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-19"><a href="#cb2-19"></a>  <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb2-20"><a href="#cb2-20"></a>  <span class="at">year =</span> <span class="dv">2020</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>) </span>
<span id="cb2-22"><a href="#cb2-22"></a>housing_data<span class="ot">&lt;-</span>housing_data<span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">"M"</span>),<span class="sc">-</span>NAME) <span class="sc">%&gt;%</span>     <span class="co">#remove margin of error</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>  <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">str_remove</span>(.x, <span class="st">"E$"</span>)) <span class="sc">%&gt;%</span>     <span class="co">#remove "E" </span></span>
<span id="cb2-25"><a href="#cb2-25"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-mhv-with-ggplot2" class="slide level2">
<h2>Mapping MHV with <code>ggplot2</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mhv_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(housing_data, <span class="fu">aes</span>(<span class="at">fill =</span> median_value)) <span class="sc">+</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Median home value "</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>mhv_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-3-1.png" width="960" class="r-stretch"></section>
<section id="goal-1" class="slide level2">
<h2>Goal 1</h2>
<ul>
<li>I’m looking to buy a house in SE Michigan.</li>
<li>I want a bargain in a desirable area</li>
<li>Let’s look for tracts that are relatively cheap but surrounded by relatively expensive areas.</li>
</ul>
</section>
<section id="local-spatial-autocorrelation" class="slide level2">
<h2>Local spatial autocorrelation</h2>
<p>First, we need to quantify the extent to which each tract is similar or different from its neighboring tracts. This is akin to calculating local spatial autocorrelation.</p>
<p>We can determine local spatial autocorrelation using a local Moran’s I statistic (LISA).</p>
<p><span class="math display">\[
I_i=\frac{(v_i-\bar{v})}{\sum_k (v_k-\bar{v})^2/(n-1)}\sum_jw_{ij}(v_j-\bar{v})
\]</span> where <span class="math inline">\(w_{ij}\)</span> is 1 if tract <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are neighbors and 0 if not, and <span class="math inline">\(v_i\)</span> is the MHV at tract <span class="math inline">\(i\)</span>.</p>
<p>Positive values indicate spatial clustering (close tracts have similar MHV). Negative values indicate potential outliers (close tracts have different MHV).</p>
</section>
<section id="coding-neighbors-in-r-with-spdep" class="slide level2">
<h2>Coding Neighbors in R with <code>spdep</code></h2>
<p>Recall <span class="math inline">\(w_{ij}'s\)</span> are equal to 1 if tract <span class="math inline">\(i\)</span> is bordering tract <span class="math inline">\(j\)</span> and 0 if not. We can find the <span class="math inline">\(w_{ij}'s\)</span> in R and visualize the neighborhood graph for SE MI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>neighbors <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(housing_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>housing_coords <span class="ot">&lt;-</span> housing_data <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">st_coordinates</span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">plot</span>(housing_data<span class="sc">$</span>geometry)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">plot</span>(neighbors, </span>
<span id="cb5-7"><a href="#cb5-7"></a>     <span class="at">coords =</span> housing_coords, </span>
<span id="cb5-8"><a href="#cb5-8"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>, </span>
<span id="cb5-9"><a href="#cb5-9"></a>     <span class="at">col =</span> <span class="st">"blue"</span>, </span>
<span id="cb5-10"><a href="#cb5-10"></a>     <span class="at">points =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-5-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Then we can define the spatial weights with a binary scheme where <span class="math inline">\(w_{ij}\)</span> is 1 if tract <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are neighbors (connected by blue line) and 0 if not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(neighbors, <span class="at">style =</span> <span class="st">"B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-local-morans-i-in-r" class="slide level2">
<h2>Calculating Local Moran’s I in R</h2>
<p>Now, back to calculating local autocorrelation via Local Moran’s I:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="1-4|5-7|9-14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>housing_moran <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  housing_data<span class="sc">$</span>median_value, </span>
<span id="cb7-3"><a href="#cb7-3"></a>  weights, </span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"local_i"</span>, <span class="st">"exp_i"</span>, <span class="st">"var_i"</span>, <span class="st">"z_i"</span>, <span class="st">"p_i"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>housing_moran_df <span class="ot">&lt;-</span> housing_data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">bind_cols</span>(housing_moran)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">ggplot</span>(housing_moran_df, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.numeric</span>(local_i)) )<span class="sc">+</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">geom_sf</span>(<span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdYlBu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"></section>
<section id="defining-clusters-based-on-local-morans-i" class="slide level2">
<h2>Defining clusters based on Local Moran’s I</h2>
<p>Recall, I am looking for a neighborhood that is cheaper than average but surrounded by neighborhoods that are expensive. We will define 4 clusters:</p>
<ul>
<li><p>High-high: high MHV, positive I</p></li>
<li><p>High-low: high MHV, negative I</p></li>
<li><p>Low-low: low MHV, positive I</p></li>
<li><p>Low-high: low MHV, negative I</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>housing_moran_clusters <span class="ot">&lt;-</span> housing_moran_df <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>    p_i<span class="sc">&gt;</span>.<span class="dv">05</span><span class="sc">~</span><span class="st">"Not signif"</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>    median_value <span class="sc">&gt;</span> <span class="fu">mean</span>(median_value) <span class="sc">&amp;</span> local_i <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-high"</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>    median_value <span class="sc">&gt;</span> <span class="fu">mean</span>(median_value) <span class="sc">&amp;</span> local_i <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-low"</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a>    median_value <span class="sc">&lt;</span> <span class="fu">mean</span>(median_value) <span class="sc">&amp;</span> local_i <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-low"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>    median_value <span class="sc">&lt;</span> <span class="fu">mean</span>(median_value) <span class="sc">&amp;</span> local_i <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-high"</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">High-high</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb10-2"><a href="#cb10-2"></a>                  <span class="st">`</span><span class="at">High-low</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"pink"</span>, </span>
<span id="cb10-3"><a href="#cb10-3"></a>                  <span class="st">`</span><span class="at">Low-low</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb10-4"><a href="#cb10-4"></a>                  <span class="st">`</span><span class="at">Low-high</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"lightblue"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>                  <span class="st">`</span><span class="at">Not signif</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"white"</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="fu">ggplot</span>(housing_moran_clusters, <span class="fu">aes</span>(<span class="at">fill =</span> cluster)) <span class="sc">+</span> </span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="fu">geom_sf</span>(<span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_values) <span class="sc">+</span> </span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Cluster type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"></section>
<section id="goal-2" class="slide level2">
<h2>Goal 2</h2>
<p>Now I want to investigate which factors influence MHV in SE Michigan.</p>
<p>We can proceed by building a model for MHV with available predictors from the survey data we already pulled.</p>
</section>
<section class="slide level2">

<p>First, let’s inspect the distribution of MHV:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>mhv_histogram <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(housing_data, <span class="fu">aes</span>(<span class="at">x =</span> median_value)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>                 <span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_si</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median home value"</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>mhv_histogram</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-11-1.png" width="960" class="r-stretch"><p>The distribution of MHV is “right-skewed”. This violates the assumption that the outcome is Gaussian or Normal for linear regression modeling.</p>
</section>
<section class="slide level2">

<p>Let’s try a log transformation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>mhv_histogram_log <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(housing_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(median_value))) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, </span>
<span id="cb12-3"><a href="#cb12-3"></a>                 <span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">scale_x_continuous</span>() <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median home value (log)"</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a> mhv_histogram_log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-12-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Let’s calculate a few variables that will be useful in modeling. We will create</p>
<ul>
<li><p><code>pop_density</code> as the total population of the census tract divided by the area of the census tract</p></li>
<li><p><code>median_structure_age</code> as the median age of the structures within the census tract</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>housing_data_for_model <span class="ot">&lt;-</span> housing_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">mutate</span>(<span class="at">pop_density =</span> <span class="fu">as.numeric</span>(<span class="fu">set_units</span>(total_population <span class="sc">/</span> <span class="fu">st_area</span>(.), <span class="st">"1/km2"</span>)),</span>
<span id="cb13-3"><a href="#cb13-3"></a>         <span class="at">median_structure_age =</span> <span class="dv">2018</span> <span class="sc">-</span> median_year_built) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="a-model" class="slide level2">
<h2>A model</h2>
<p>Let’s fit this linear regression model:</p>
<p><span class="math display">\[
\log(MHV_i)=\alpha + \beta_1*(\text{median_rooms}_i) + \beta_2*(\text{median_income}_i) + \\ \beta_3*(\text{pct_college}_i) + \beta_4*(\text{pct_foreign_born}_i) + \\ \beta_5*(\text{pct_white}_i)
+ \beta_6*(\text{median_age}_i) + \\ \beta_7*(\text{median_structure_age}_i) + \beta_8*(\text{percent_ooh}_i) + \\ \beta_9*(\text{pop_density}_i) + \epsilon_i\\
\]</span></p>
<p>For simplicity we can write:</p>
<p><span class="math display">\[
log(MHV_i)=\alpha + \sum_{p=1}^9{X}_{pi}{\beta}_p+\epsilon_i
\]</span></p>
</section>
<section id="a-model-in-r" class="slide level2">
<h2>A model in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="1|3|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>formula <span class="ot">&lt;-</span> <span class="st">"log(median_value) ~ median_rooms + median_income + pct_college + pct_foreign_born + pct_white + median_age + median_structure_age + percent_ooh + pop_density"</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> formula, <span class="at">data =</span> housing_data_for_model)</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula, data = housing_data_for_model)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.32908 -0.14889  0.01438  0.17966  1.77185 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           1.027e+01  9.204e-02 111.553  &lt; 2e-16 ***
median_rooms         -3.110e-03  1.579e-02  -0.197 0.843869    
median_income         6.336e-06  7.390e-07   8.574  &lt; 2e-16 ***
pct_college           1.566e-02  8.316e-04  18.831  &lt; 2e-16 ***
pct_foreign_born      3.687e-03  1.006e-03   3.667 0.000256 ***
pct_white             8.936e-03  4.499e-04  19.860  &lt; 2e-16 ***
median_age            1.067e-02  1.536e-03   6.950 5.86e-12 ***
median_structure_age -5.619e-05  2.063e-05  -2.723 0.006561 ** 
percent_ooh          -4.614e-03  8.007e-04  -5.763 1.04e-08 ***
pop_density          -6.772e-06  1.089e-05  -0.622 0.533982    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.333 on 1254 degrees of freedom
Multiple R-squared:  0.8206,    Adjusted R-squared:  0.8193 
F-statistic: 637.4 on 9 and 1254 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Anything unexpected in these results?</p>
</section>
<section id="multicollinearity" class="slide level2">
<h2>Multicollinearity</h2>
<p>Let’s investigate potential multicollinearity in our data by visually checking for highly correlated variables. A correlation matrix plot is useful here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="1-3|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>estimates <span class="ot">&lt;-</span> housing_data_for_model <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>GEOID, <span class="sc">-</span>median_value, <span class="sc">-</span>median_year_built,<span class="sc">-</span>total_population) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(estimates, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggcorrplot</span>(correlations,<span class="at">method=</span><span class="st">"circle"</span>,<span class="at">type=</span><span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-16-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>We can also calculate the variance inflation factor (VIF) for each variable. The VIF is the ratio of the variance of estimating each coefficient in a multiple regression model by the variance of a model constructed using only one term. A VIF of 1 indicates no collinearity; VIF values above 5 suggest a level of collinearity that has problematic influence on model interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">vif</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        median_rooms        median_income          pct_college 
            3.929025             7.813064             3.532471 
    pct_foreign_born            pct_white           median_age 
            1.251486             2.383198             1.425641 
median_structure_age          percent_ooh          pop_density 
            1.207343             3.695615             1.500314 </code></pre>
</div>
</div>
<p><code>median_income</code> has a VIF of over 7. A potential solution involves removing this variable and re-running the model; as it is highly correlated with other predictors in the model, the effect of median household income would in theory be captured by the remaining predictors.</p>
</section>
<section id="another-model-in-r" class="slide level2">
<h2>Another model in R</h2>
<p>Dropping the <code>median_income</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" data-code-line-numbers="1|3|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>formula2 <span class="ot">&lt;-</span> <span class="st">"log(median_value) ~ median_rooms +  pct_college + pct_foreign_born + pct_white + median_age + median_structure_age + percent_ooh + pop_density"</span></span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> formula2, <span class="at">data =</span> housing_data_for_model)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula2, data = housing_data_for_model)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.41914 -0.15727  0.01071  0.19438  1.85719 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           9.968e+00  8.759e-02 113.799  &lt; 2e-16 ***
median_rooms          7.067e-02  1.361e-02   5.191 2.43e-07 ***
pct_college           2.068e-02  6.073e-04  34.058  &lt; 2e-16 ***
pct_foreign_born      4.157e-03  1.033e-03   4.025 6.03e-05 ***
pct_white             9.947e-03  4.465e-04  22.276  &lt; 2e-16 ***
median_age            1.070e-02  1.579e-03   6.774 1.92e-11 ***
median_structure_age -9.102e-05  2.081e-05  -4.374 1.32e-05 ***
percent_ooh          -3.311e-03  8.085e-04  -4.095 4.49e-05 ***
pop_density          -1.949e-05  1.109e-05  -1.758   0.0791 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3425 on 1255 degrees of freedom
Multiple R-squared:  0.8101,    Adjusted R-squared:  0.8089 
F-statistic: 669.3 on 8 and 1255 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="model-diagnostics" class="slide level2">
<h2>Model diagnostics</h2>
<p>Residuals should be Gaussian distributed, independent, constant variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>housing_data_for_model<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model2)</span>
<span id="cb22-2"><a href="#cb22-2"></a>housing_data_for_model<span class="sc">$</span>fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model2)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>diagnostic1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(housing_data_for_model, <span class="fu">aes</span>(<span class="at">x =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>diagnostic2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(housing_data_for_model, <span class="fu">aes</span>(<span class="at">y =</span> residuals,<span class="at">x=</span>fitted)) <span class="sc">+</span> </span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-12"><a href="#cb22-12"></a></span>
<span id="cb22-13"><a href="#cb22-13"></a>diagnostic1<span class="sc">+</span>diagnostic2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-19-1.png" width="960" class="r-stretch"><p>Independent? Let’s check.</p>
</section>
<section id="assessing-spatial-autocorrelation" class="slide level2">
<h2>Assessing Spatial Autocorrelation</h2>
<p>Spatial autocorrelation is a measure of similarity between nearby observations in space. Let’s check for spatial autocorrelation in the residuals from model 2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>housing_data_for_model<span class="sc">%&gt;%</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> residuals)) <span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Residual"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"></section>
<section id="global-morans-i-statistic" class="slide level2">
<h2>Global Moran’s I statistic</h2>
<p>We can compute a global level of spatial autocorrealtion of the model residuals to see if the residuals are correlated in space.</p>
<p><span class="math display">\[
I=\frac{N}{W}\frac{\sum_i\sum_j w_{ij}(r_i-\bar{r})(r_j-\bar{r})}{\sum_i(r_i-\bar{r})^2}
\]</span></p>
<p>where <span class="math inline">\(w_{ij}\)</span> is the “spatial weight” between tract <span class="math inline">\(i\)</span> and tract <span class="math inline">\(j\)</span>, <span class="math inline">\(N\)</span> is the number of tracts, <span class="math inline">\(W\)</span> is the sum of the <span class="math inline">\(w_{ij}\)</span>’s, <span class="math inline">\(r_i\)</span> is the residual at tract <span class="math inline">\(i\)</span>, <span class="math inline">\(\bar{r}\)</span> is the mean residual.</p>
<p>The form of Moran’s I is a weighted sum of cross-products of deviations from the mean. When values for features <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are both larger or smaller than the mean, the cross product will be positive. When one is smaller and one is larger, the cross product will be negative. If the values in a data set tend to cluster spatially (high near high and low near low), I will be positive. If like values tend to repel each other, I will be negative. If values are randomly dispersed, I will be near zero.</p>
</section>
<section class="slide level2">

<p>We will use the spatial weights from before and compute global Moran’s I.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">moran.test</span>(housing_data_for_model<span class="sc">$</span>residuals, weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  housing_data_for_model$residuals  
weights: weights    

Moran I statistic standard deviate = 12.965, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.2050100255     -0.0007917656      0.0002519739 </code></pre>
</div>
</div>
<p>Moran’s I is about 0.2 which is significantly higher than 0 indicating spatial autocorrelation in the residuals. So our model is misspecified!</p>
</section>
<section id="car-model" class="slide level2">
<h2>CAR model</h2>
<p>We can account for the spatial autocorrelation in the outcome MHV by adding an additional term to the linear regression model:</p>
<p><span class="math display">\[
Y_i \sim \alpha + \sum_{p=1}^P{X}_{pi}{\beta}_p+\phi_i
\]</span></p>
<p>The <span class="math inline">\(\phi_i\)</span> is the spatial random effect for tract <span class="math inline">\(i\)</span>. In a Bayesian context we specify a prior for <span class="math inline">\(\phi_i\)</span> with the following form:</p>
<p><span class="math display">\[
\phi_i|\boldsymbol{\phi}_{-i},\boldsymbol{W},\tau^2,\rho \sim N\bigg(\frac{\rho\sum_jw_{ij}\phi_j}{\rho\sum_jw_{ij}+1-\rho},\frac{\tau^2}{\rho\sum_jw_{ij}+1-\rho}\bigg)
\]</span></p>
<p>The spatial effect at tract <span class="math inline">\(i\)</span> follows a Gaussian distribution with the mean proportional to the weighted sum of the spatial effects at neighboring tracts. This will induce spatial autocorrelation in the outcome variable, MHV.</p>
</section>
<section id="fitting-a-car-model-in-r-using-carbayes" class="slide level2">
<h2>Fitting a CAR model in R using <code>CARBayes</code></h2>
<p>The CAR model requires MCMC to estimate the posterior distribution of the model parameters. We need to specify <span class="math inline">\(W\)</span>, the neighborhood matrix. We will again use the binary coding scheme which gives a weight of 1 if two tracts share a border and 0 if not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>CARmodel <span class="ot">&lt;-</span> <span class="fu">S.CARleroux</span>(<span class="at">formula=</span>formula2, <span class="at">data=</span>housing_data_for_model, </span>
<span id="cb26-2"><a href="#cb26-2"></a>                        <span class="at">family=</span><span class="st">"gaussian"</span>, <span class="at">W=</span><span class="fu">listw2mat</span>(weights), </span>
<span id="cb26-3"><a href="#cb26-3"></a>                        <span class="at">burnin=</span><span class="dv">10000</span>, <span class="at">n.sample=</span><span class="dv">50000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>With the posterior samples we can calculate 95% credible intervals and Bayesian p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="1-2|3-5|6-7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>beta.samples.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(CARmodel<span class="sc">$</span>samples<span class="sc">$</span>beta)</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">colnames</span>(beta.samples.matrix) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(CARmodel<span class="sc">$</span>X)</span>
<span id="cb27-3"><a href="#cb27-3"></a>mcmc.p<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">length</span>(<span class="fu">which</span>(x<span class="sc">&lt;</span><span class="dv">0</span>))<span class="sc">/</span><span class="fu">length</span>(x),<span class="fu">length</span>(<span class="fu">which</span>(x<span class="sc">&gt;</span><span class="dv">0</span>))<span class="sc">/</span><span class="fu">length</span>(x))</span>
<span id="cb27-5"><a href="#cb27-5"></a>}</span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="fu">round</span>(<span class="fu">t</span>(<span class="fu">rbind</span>(<span class="at">estimate=</span><span class="fu">apply</span>(beta.samples.matrix, <span class="dv">2</span>, mean), <span class="fu">apply</span>(beta.samples.matrix,</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="dv">2</span>, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),<span class="at">p=</span><span class="fu">apply</span>(beta.samples.matrix,<span class="dv">2</span>,mcmc.p))), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     estimate     2.5%    97.5%       p
(Intercept)          10.01203  9.83455 10.18700 0.00000
median_rooms          0.11086  0.08442  0.13808 0.00000
pct_college           0.01999  0.01824  0.02170 0.00000
pct_foreign_born      0.00625  0.00366  0.00888 0.00000
pct_white             0.00697  0.00568  0.00825 0.00000
median_age            0.00701  0.00404  0.01003 0.00000
median_structure_age -0.00007 -0.00012 -0.00003 0.00130
percent_ooh          -0.00345 -0.00495 -0.00197 0.00000
pop_density           0.00002 -0.00001  0.00004 0.15625</code></pre>
</div>
</div>
<p>For the most part, the estimates from the CAR model are in agreement with the non-spatial linear regression model. However, <code>pop_density</code> changed directionality and lost significance.</p>
</section>
<section id="model-diagnostics-car-model" class="slide level2">
<h2>Model diagnostics CAR model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="1|3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>housing_data_for_model<span class="sc">$</span>car_residuals<span class="ot">&lt;-</span>CARmodel<span class="sc">$</span>residuals<span class="sc">$</span>response</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">moran.test</span>(housing_data_for_model<span class="sc">$</span>car_residuals, weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  housing_data_for_model$car_residuals  
weights: weights    

Moran I statistic standard deviate = -8.4658, p-value = 1
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
    -0.1349552476     -0.0007917656      0.0002511471 </code></pre>
</div>
</div>
<p>Now, the I statistic is negative with p-value=1. There is no longer any evidence that residuals are spatially autocorrelated.</p>
</section>
<section id="goal-3-explore-non-stationarity-in-the-predictors" class="slide level2">
<h2>Goal 3: Explore non-stationarity in the predictors</h2>
<p>The CAR model estimates global associations between the outcome variable, MHV, and its predictors. This lends itself to conclusions like “In SE Michigan, higher levels of educational attainment are associated with higher MHVs.” However, it is possible that a realtionship between outcome and predictor may vary from neighborhood to neighborhood. This phenomenon is called spatial non-stationarity.</p>

<img data-src="images/Screen%20Shot%202023-07-12%20at%2010.19.41%20AM.png" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://gistbok.ucgis.org/bok-topics/geographically-weighted-regression-framework">Source</a></p></section>
<section id="gwr" class="slide level2">
<h2>GWR</h2>
<p>Geographically weighted regression (GWR) is designed to evaluate local variations in the results of regression models. The basic form of GWR for tract <span class="math inline">\(i\)</span> can be written as:</p>
<p><span class="math display">\[
log(MHV_i)=\alpha_i + \sum_{p=1}^P\beta_{ip}X_{ip}+\epsilon_i
\]</span></p>
<p>where <span class="math inline">\(P\)</span> is the number of predictors. Contrasting this with the previously defined model:</p>
<p><span class="math display">\[
log(MHV_i)=\alpha + \sum_{p=1}^P\beta_{p}X_{ip}+\epsilon_i
\]</span></p>
</section>
<section id="data-borrowing" class="slide level2">
<h2>Data borrowing</h2>
<p>GWR uses a moving-window weighting technique to obtain separate regression equations for each spatial location. For a target tract, neighboring tracts are weighted based on a distance decay function. Closer locations will have greater influence on the results for the local model and further locations will have less influence.</p>

<img data-src="gwr.png" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://gistbok.ucgis.org/bok-topics/geographically-weighted-regression-framework">Source</a></p></section>
<section id="distance-decay-functions" class="slide level2">
<h2>Distance-decay functions</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>The form of the distance decay function must be specified.</li>
<li>Examples are Gaussian, Bi-square, and Exponential.</li>
<li>They differ in the rate at which the spatial weights decline.</li>
</ul>
<p>Gaussian: <span class="math inline">\(w_{ij}=\exp(-\frac{d_{ij}^2}{h^2})\)</span></p>
<p>Exponential: <span class="math inline">\(w_{ij}=\exp(-\frac{d_{ij}}{h})\)</span></p>
<p>Bi-square: <span class="math inline">\(w_{ij}=1-(\frac{d_{ij}^2}{h^2})^2\)</span></p>
</div><div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="gwr2.png"></p>
<figcaption><a href="https://gistbok.ucgis.org/bok-topics/geographically-weighted-regression-framework">Source</a></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bandwidth" class="slide level2">
<h2>Bandwidth</h2>
<p>The bandwidth, h, is a parameter of the distance decay function and can be specified by the user or chosen via cross-validation. In an adaptive GWR the bandwidth is the nearest neighbor at which the weights fall to zero, or approximately zero.</p>
<ul>
<li><p>small bandwidth = restricts data included in local regression to only those recorded in close proximity to the regression point</p></li>
<li><p>large bandwidth = data from locations further away influence the local regression</p></li>
<li><p>Bias - variance trade-off</p>
<ul>
<li><p>larger bandwidth -&gt; larger bias</p></li>
<li><p>smaller bandwidth -&gt; larger variance</p></li>
</ul></li>
</ul>
</section>
<section class="slide level2">


<img data-src="bw.png" class="r-stretch quarto-figure-center"><p class="caption">Spatial weights at different bandwidths for areal data. <a href="https://gistbok.ucgis.org/bok-topics/geographically-weighted-regression-framework">Source</a></p></section>
<section id="fitting-gwr-model-with-gwmodel" class="slide level2">
<h2>Fitting GWR model with <code>GWmodel</code></h2>
<p>We will set the bandwidth to 100 and use the bi-square decay function. This means that the local regression model fit at tract <span class="math inline">\(i\)</span> uses data from only the 100 nearest neighbors. Once the bandwidth is chosen we can run the model and plot the results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" data-code-line-numbers="1-2|4-10|12-13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>housing_data_sp <span class="ot">&lt;-</span> housing_data_for_model <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>   <span class="fu">as_Spatial</span>()</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>gw_model <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(</span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="at">formula =</span> formula2, </span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="at">data =</span> housing_data_sp, </span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="at">bw =</span> <span class="dv">100</span>,</span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="at">kernel =</span> <span class="st">"bisquare"</span>,</span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>)</span>
<span id="cb31-11"><a href="#cb31-11"></a></span>
<span id="cb31-12"><a href="#cb31-12"></a>gw_model_results <span class="ot">&lt;-</span> gw_model<span class="sc">$</span>SDF <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>  <span class="fu">st_as_sf</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>We can plot local <span class="math inline">\(R^2\)</span> estimates to assess how the model is fitting locally:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> Local_R2)) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local R^2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-26-1.png" width="960" class="r-stretch"><p>The model doesn’t fit as well in some edge areas.</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> pct_college)) <span class="sc">+</span> </span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb33-5"><a href="#cb33-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local β for </span><span class="sc">\n</span><span class="st">pct_college"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-27-1.png" width="960" class="r-stretch"><p>In the global model, percent with a college degree is positively associated with MHV. It seems this relationship is even stronger in the neighborhoods immediately surrounding downtown Detroit.</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> percent_ooh)) <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local β for </span><span class="sc">\n</span><span class="st">percent_ooh"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch"><p>In the global model, percent owner-occupied is negatively associated with MHV. It seems this relationship is strongest in downtown Detroit. Suburban areas surrounding Detroit tend to have more positive associations between percent owner-occupied and MHV.</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggplot</span>(gw_model_results, <span class="fu">aes</span>(<span class="at">fill =</span> median_rooms)) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Local β for </span><span class="sc">\n</span><span class="st">median_rooms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lecture_slides_files/figure-revealjs/unnamed-chunk-29-1.png" width="960" class="r-stretch"><p>The local estimates for the effect of median rooms tends to be consistent over the area except for a few spots. The upper right hand corner of the map is near / on the lake. Homes on the waterfront in this area tend to be very expensive and may be influencing local estimates here.</p>
</section>
<section id="questions" class="slide level2">
<h2>Questions ?</h2>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li><p>Point pattern data: <a href="https://spatstat.org">spatstat.org</a></p></li>
<li><p><a href="https://www.paulamoraga.com/book-geospatial/sec-arealdatatheory.html">Areal &amp; geostatistical data modeling with INLA</a></p></li>
<li><p><a href="https://gistbok.ucgis.org/bok-topics/geographically-weighted-regression-framework">GWR</a></p></li>
</ul>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lecture_slides_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lecture_slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lecture_slides_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lecture_slides_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>